import init,{find_panels}from"./pkg/kumiko_wasm.js";async function run(){await init();const e=document.getElementById("imageUploadFiles"),n=document.getElementById("imageUploadFolder"),a=document.getElementById("loadExample");let t;function r(e){console.log(e);const n=Array.from(e).filter(e=>e.type.startsWith("image/")).sort((e,n)=>e.name.localeCompare(n.name));if(n.length>0){const e=[],a=n.map(n=>new Promise((a,t)=>{const r=new FileReader;r.onload=async r=>{const s=new Uint8Array(r.target.result);try{const t=find_panels(s,.02,.05,"rtl",10,10,10,10),[o,i]=JSON.parse(t);e.push({filename:URL.createObjectURL(new Blob([r.target.result],{type:n.type})),size:o,panels:i}),a()}catch(e){console.error("Error finding panels:",e),t(e)}},r.readAsArrayBuffer(n)}));Promise.all(a).then(()=>{t&&t.gui.empty(),t=new Reader({container:$("#kumiko-reader"),images_dir:"urls",comicsJson:e,controls:!0}),t.start()})}else console.log("No images selected.")}e.addEventListener("change",e=>{r(e.target.files)}),n.addEventListener("change",e=>{r(e.target.files)}),a.addEventListener("click",()=>{!async function(){try{const e=[],n=["examples/manga1/0001.jpg","examples/manga1/0002.jpg","examples/manga1/0003.jpg"];for(const a of n){const n=await fetch(a),t=await n.blob(),r=await new Response(t).arrayBuffer(),s=new Uint8Array(r),o=find_panels(s,.02,.05,"rtl",10,10,10,10),[i,l]=JSON.parse(o);e.push({filename:URL.createObjectURL(t),size:i,panels:l})}t&&t.gui.empty(),t=new Reader({container:$("#kumiko-reader"),images_dir:"urls",comicsJson:e,controls:!0}),t.start()}catch(e){console.error("Error loading example:",e)}}()})}run();